#称帝改元 
found_new_chinese_empire_effect = {
	custom_tooltip = create_new_empire
	show_as_tooltip = {
		every_held_title = {
			custom = create_title_every_held_kingdom
			limit = {
				tier <= tier_kingdom
			}
			custom_tooltip = create_custom_empire_de_jure_changes
		}
	}
	primary_title = {
		save_scope_as = old_title
	}
	hidden_effect = {
		title:e_celestia = {
			every_in_de_jure_hierarchy = {
				limit = { tier >= tier_duchy }
				set_de_jure_liege_title = title:e_celestia
			}
			set_color_from_title = scope:old_title 
			set_capital_county = title:c_luoyang
		}
	}
	save_scope_as = founder
	if = {
		limit = {
			NOT = { exists = title:e_celestia.holder }
		}
		create_title_and_vassal_change = {
			type = created
			save_scope_as = title_change
			add_claim_on_loss = yes
		}
		title:e_celestia = {
			change_title_holder = {
				holder = scope:founder
				change = scope:title_change
			}
		}
		resolve_title_and_vassal_change = scope:title_change
	}
	else_if = {
		limit = {
			NOT = { title:e_celestia.holder = scope:founder }
		}

		destroy_title = title:e_celestia

		create_title_and_vassal_change = {
			type = created
			save_scope_as = title_change
			add_claim_on_loss = yes
		}
		title:e_celestia = {
			change_title_holder = {
				holder = scope:founder
				change = scope:title_change
			}
		}
		resolve_title_and_vassal_change = scope:title_change
	}
	scope:founder = {
		add_trait = founding_monarch
		change_government = imperial_government
	}
	#title:e_celestia = { set_title_name = scope:old_title }
	#title:e_celestia = { set_coa = scope:old_title }
	trigger_event = major_decisions.1103

	every_player = {
		if = {
			limit = {
				top_liege = scope:founder
				NOT = { this = root }
			}
			trigger_event = major_decisions.1104
		}
		else_if = {
			#Notify any players who lose de jure territory
			limit = {
				exists = scope:send_notifications
				NOT = { this = root }
				NOT = { top_liege = scope:founder }
				any_held_title = {
					any_in_de_jure_hierarchy = {
						continue = {
							tier > tier_kingdom
						}
						tier = tier_kingdom
						is_in_list = kingdoms_for_notification
					}
				}
			}
			every_held_title = {
				every_in_de_jure_hierarchy = {
					continue = {
						tier > tier_kingdom
					}
					limit = {
						tier = tier_kingdom
						is_in_list = kingdoms_for_notification
					}
					add_to_list = notification_titles
				}
			}
			if = {
				limit = {
					any_in_list = {
						list = notification_titles
						count > 0
					}
				}
				trigger_event = major_decisions.1105
			}
		}
		else_if = {  #效忠事件
			limit = {
				capital_province = { geographical_region = world_asia_china }
				primary_title.tier > tier_county
				OR = {
					is_dependent_ruler = yes
					AND = {
						NOT = { this = root }
						NOT = { top_liege = scope:founder }
						NOT = { 
							top_liege = {
								capital_province = { geographical_region = world_asia_china }
							} 
						}
					}
				}
			}
			trigger_event = {
				id = east_title.0004
				days = 10
			}
		}
	}	
}

create_tang_empire_scripted_effect = {
	add_trait = founding_monarch
	create_title_and_vassal_change = {
		type = created
		save_scope_as = title_change
		add_claim_on_loss = no
	}
	title:e_tang = {
		change_title_holder = {
			holder = root
			change = scope:title_change
		}
		change_government = imperial_government
	}
	resolve_title_and_vassal_change = scope:title_change
	set_primary_title_to = title:e_tang

	title:e_tang = {
		set_coa = e_tang
		set_color_from_title = scope:old_title
		set_capital_county = scope:old_title.title_capital_county
		copy_title_history = scope:old_title
		change_government = imperial_government
	}

	hidden_effect = {
		every_held_title = {
			limit = {
				tier = tier_empire
				NOT = { this = title:e_tang }
			}
			every_in_de_jure_hierarchy = {
				continue = {
					tier >= tier_kingdom
				}
				limit = {
					tier = tier_kingdom
					OR = {
						holder = root
						holder = { target_is_liege_or_above = root }
					}
					NOT = { is_in_list = new_de_jure_kingdoms }
				}
				add_to_list = new_de_jure_kingdoms
			}
			add_to_list = empire_for_destruction
		}

		every_held_title = {
			limit = {
				tier = tier_kingdom
				NOT = { is_in_list = new_de_jure_kingdoms }
			}
			add_to_list = new_de_jure_kingdoms
		}
		every_in_list = {
			list = new_de_jure_kingdoms
			limit = {
				trigger_if = {
					limit = {
						exists = this
						root = { is_ai = yes }
						exists = holder
					}
					NOR = {
						holder.top_liege = { is_ai = no }
						holder = { is_ai = no }
					}
				}
			}
			set_de_jure_liege_title = title:e_tang
		}
		every_in_list = {
			list = empire_for_destruction
			limit = {
				NOT = { this = title:e_tang } #Just a little safeguarding
			}
			root = {
				destroy_title = prev
			}
		}

		#Notifications for characters who hold land that is now claimed
		title:e_tang = {
			every_in_de_jure_hierarchy = {
				continue = {
					tier >= tier_duchy
				}
				limit = {
					exists = holder
					holder = {
						NOR = {
							this = root
							target_is_liege_or_above = root
						}
					}
				}
				holder = {
					if = {
						limit = {
							NOT = { is_in_list = notification_sent }
						}
						add_to_temporary_list = notification_sent
					}
				}
			}
		}

		every_vassal = {
			limit = {
				NOT = {
					is_in_list = notification_sent
				}
			}
		}
	}
	root = { add_pressed_claim = title:e_celestia }
	trigger_event = major_decisions.1103
}

build_han_empire_effect = {
	custom_tooltip = create_new_empire
	show_as_tooltip = {
		every_held_title = {
			custom = create_title_every_held_kingdom
			limit = {
				tier <= tier_kingdom
			}
			custom_tooltip = create_custom_empire_de_jure_changes
		}
	}

	create_title_and_vassal_change = {
		type = created
		save_scope_as = title_change
		add_claim_on_loss = no
	}
	title:e_han = {
		change_title_holder = {
			holder = root
			change = scope:title_change
		}
	}
	resolve_title_and_vassal_change = scope:title_change

	root = { add_pressed_claim = title:e_celestia }
	set_primary_title_to = title:e_han

	title:e_han = {
		set_coa = e_han
		set_color_from_title = scope:old_title
		set_capital_county = scope:old_title.title_capital_county
		copy_title_history = scope:old_title
		change_government = imperial_government
	}
	trigger_event = major_decisions.1103	
}

found_min_kingdom_effect = {
	custom_tooltip = create_new_kingdom
	show_as_tooltip = {
		every_held_title = {
			custom = create_title_every_held_duchy
			limit = {
				tier = tier_duchy
			}
			custom_tooltip = create_custom_kingdom_de_jure_changes
		}
	}

	hidden_effect = {
		save_scope_as = founder
		primary_title = {
			save_scope_as = old_title
		}
		
		create_dynamic_title = {
			tier = kingdom
			name = MIN
		}
		create_title_and_vassal_change = {
			type = created
			save_scope_as = change
			add_claim_on_loss = no
		}
		
		scope:new_title = {
			change_title_holder = {
				holder = root
				change = scope:change
			}
		}
		
		resolve_title_and_vassal_change = scope:change

		#Check if all territory is from a single Empire, and if so, make Kingdom de jure of that Empire
		every_sub_realm_county = {
			if = {
				limit = {
					exists = empire
				}
				empire = {
					if = {
						limit = {
							NOT = {
								is_in_list = potential_empires
							}
						}
						add_to_list = potential_empires
					}
				}
			}
		}
		if = {
			limit = {
				any_in_list = {
					list = potential_empires
					count > 0
				}
			}
			ordered_in_list = {
				list = potential_empires
				order_by = {
					every_in_de_jure_hierarchy = {
						continue = {
							tier > tier_county
						}
						limit = {
							tier = tier_county
							holder.top_liege = root
						}
						add = 1
					}
				}
				position = 0
				save_scope_as = old_empire
			}
		}
		if = {
			limit = {
				exists = scope:old_empire
			}
			scope:new_title = {
				set_de_jure_liege_title = scope:old_empire
			}
		}
		
		every_held_title = {
			limit = {
				tier = tier_duchy
			}
			if = {
				limit = {
					#Check if you need to notify a player
					OR = {
						AND = {
							exists = kingdom
							kingdom = {
								exists = holder
								holder = {
									NOT = { this = root }
									is_ai = no
								}
							}
						}
						AND = {
							exists = empire
							empire = {
								exists = holder
								holder = {
									NOT = { this = root }
									is_ai = no
								}
							}
						}
					}
				}
				add_to_temporary_list = duchy_for_notification
				root = {
					save_temporary_scope_value_as = {
						name = send_notifications
						value = yes
					}
				}
			}
			set_de_jure_liege_title = scope:new_title
		}

		every_sub_realm_county = {
			limit = {
				exists = duchy
				NOT = { exists = duchy.holder }
				holder.top_liege = root
				duchy = {
					save_temporary_scope_as = test_duchy
				}
				holder.top_liege = {
					completely_controls = scope:test_duchy
				}
			}
			if = {
				limit = {
					NOT = {
						duchy = {
							is_in_list = additional_de_jure_duchies
						}
					}
				}
				duchy = {
					set_de_jure_liege_title = scope:new_title
					add_to_list = additional_de_jure_duchies
				}
			}
		}
		
		scope:new_title = {
			set_title_name = MIN
			set_coa = scope:old_title
			set_color_from_title = scope:old_title
			set_capital_county = scope:old_title.title_capital_county
		}
		set_primary_title_to = scope:new_title
		
		trigger_event = major_decisions.1101
		
		every_player = {
			if = {
				limit = {
					top_liege = scope:founder
					NOT = { this = root }
				}
				trigger_event = major_decisions.1102
			}
			else_if = {
				limit = {
					exists = scope:send_notifications
					NOT = { this = root }
					NOT = { top_liege = scope:founder }
					any_held_title = {
						any_in_de_jure_hierarchy = {
							continue = {
								tier > tier_duchy
							}
							tier = tier_duchy
							is_in_list = duchy_for_notification
						}
					}
				}
				every_held_title = {
					every_in_de_jure_hierarchy = {
						continue = {
							tier > tier_duchy
						}
						limit = {
							tier = tier_duchy
							is_in_list = duchy_for_notification
						}
						add_to_list = notification_titles	
					}
				}			
				if = {
					limit = {
						any_in_list = {
							list = notification_titles
							count > 0
						}
					}
					trigger_event = major_decisions.1105
				}
			}
		}
	}
}

found_wuyue_kingdom_effect = {
	custom_tooltip = create_new_kingdom
	show_as_tooltip = {
		every_held_title = {
			custom = create_title_every_held_duchy
			limit = {
				tier = tier_duchy
			}
			custom_tooltip = create_custom_kingdom_de_jure_changes
		}
	}

	hidden_effect = {
		save_scope_as = founder
		primary_title = {
			save_scope_as = old_title
		}
		
		create_dynamic_title = {
			tier = kingdom
			name = WUYUE
		}
		create_title_and_vassal_change = {
			type = created
			save_scope_as = change
			add_claim_on_loss = no
		}
		
		scope:new_title = {
			change_title_holder = {
				holder = root
				change = scope:change
			}
		}
		
		resolve_title_and_vassal_change = scope:change

		#Check if all territory is from a single Empire, and if so, make Kingdom de jure of that Empire
		every_sub_realm_county = {
			if = {
				limit = {
					exists = empire
				}
				empire = {
					if = {
						limit = {
							NOT = {
								is_in_list = potential_empires
							}
						}
						add_to_list = potential_empires
					}
				}
			}
		}
		if = {
			limit = {
				any_in_list = {
					list = potential_empires
					count > 0
				}
			}
			ordered_in_list = {
				list = potential_empires
				order_by = {
					every_in_de_jure_hierarchy = {
						continue = {
							tier > tier_county
						}
						limit = {
							tier = tier_county
							holder.top_liege = root
						}
						add = 1
					}
				}
				position = 0
				save_scope_as = old_empire
			}
		}
		if = {
			limit = {
				exists = scope:old_empire
			}
			scope:new_title = {
				set_de_jure_liege_title = scope:old_empire
			}
		}
		
		every_held_title = {
			limit = {
				tier = tier_duchy
			}
			if = {
				limit = {
					#Check if you need to notify a player
					OR = {
						AND = {
							exists = kingdom
							kingdom = {
								exists = holder
								holder = {
									NOT = { this = root }
									is_ai = no
								}
							}
						}
						AND = {
							exists = empire
							empire = {
								exists = holder
								holder = {
									NOT = { this = root }
									is_ai = no
								}
							}
						}
					}
				}
				add_to_temporary_list = duchy_for_notification
				root = {
					save_temporary_scope_value_as = {
						name = send_notifications
						value = yes
					}
				}
			}
			set_de_jure_liege_title = scope:new_title
		}

		every_sub_realm_county = {
			limit = {
				exists = duchy
				NOT = { exists = duchy.holder }
				holder.top_liege = root
				duchy = {
					save_temporary_scope_as = test_duchy
				}
				holder.top_liege = {
					completely_controls = scope:test_duchy
				}
			}
			if = {
				limit = {
					NOT = {
						duchy = {
							is_in_list = additional_de_jure_duchies
						}
					}
				}
				duchy = {
					set_de_jure_liege_title = scope:new_title
					add_to_list = additional_de_jure_duchies
				}
			}
		}
		
		scope:new_title = {
			set_title_name = WUYUE
			set_coa = scope:old_title
			set_color_from_title = scope:old_title
			set_capital_county = scope:old_title.title_capital_county
		}
		set_primary_title_to = scope:new_title
		
		trigger_event = major_decisions.1101
		
		every_player = {
			if = {
				limit = {
					top_liege = scope:founder
					NOT = { this = root }
				}
				trigger_event = major_decisions.1102
			}
			else_if = {
				limit = {
					exists = scope:send_notifications
					NOT = { this = root }
					NOT = { top_liege = scope:founder }
					any_held_title = {
						any_in_de_jure_hierarchy = {
							continue = {
								tier > tier_duchy
							}
							tier = tier_duchy
							is_in_list = duchy_for_notification
						}
					}
				}
				every_held_title = {
					every_in_de_jure_hierarchy = {
						continue = {
							tier > tier_duchy
						}
						limit = {
							tier = tier_duchy
							is_in_list = duchy_for_notification
						}
						add_to_list = notification_titles	
					}
				}			
				if = {
					limit = {
						any_in_list = {
							list = notification_titles
							count > 0
						}
					}
					trigger_event = major_decisions.1105
				}
			}
		}
	}
}

replace_celestia_empire_effect = {

		create_title_and_vassal_change = {
			type = usurped
			save_scope_as = change
			add_claim_on_loss = yes
		}
		title:e_celestia = {
			change_title_holder = {
				holder = root
				change = scope:change
			}
		}
		resolve_title_and_vassal_change = scope:change
}